<html>
<body>
    aoc4
    <canvas id="Canvas1" width="1500" height="1500" style="border: 1px solid black;">
<script>
var c1 = document.getElementById("Canvas1");
var ct1 = c1.getContext("2d");
    var ins=[], grid=[]
  fileLoad();
    async function fileLoad() {
  try {
    const response = await fetch('info16.txt');
    var data = await response.text();
   
    ins = data.split('\n');
  } catch (error) {
    alert('Error reading file:'+error);
  }
     
ins.pop()
 start()      
    }
var dir=0,m=0,sc=10
var okRL=[".","-"], okUD=[".","|"]
ct1.font="10px Monospace"
function start(){
display()
var n={x:0,y:0}
setTimeout(function(){move(0,0,0)},1000)
}
function move(d1,a1,b1){
    setTimeout(function(){mov2(d1,a1,b1)},2)
}
function mov2(d,a,b){ 
    m++
    ct1.clearRect(100,0,100,9)
    ct1.fillText(m,100,9)
    if( a<0 || a>=ins[0].length || b<0 || b>=ins.length){return}
    show(d,a,b)
    gid[b][a]="x"
    if(m%8000==1000){alert(coun() )}
    c=ins[b].charAt(a)
    if(d==0){
        if( okRL.includes(c) ){ move(0,a+1,b); return}
        else{
         if(c=="/"){ move(3,a,b-1); return}
         if(c="\\"){ move(1,a,b+1); return}
         if(c=="|"){ setTimeout(function(){move(1,a,b+1)},20);
                     setTimeout(function(){move(3,a,b-1)},20); return}
        }
    }
    
     if(d==1){
        
        if( okUD.includes(c) ){ move(1,a,b+1); return}
        else{
         if(c=="/"){ move(2,a-1,b); return}
         if(c=="\\"){ move(0,a+1,b); return}
         if(c=="-"){ setTimeout(function(){move(0,a+1,b)},20);
                    setTimeout(function(){move(2,a-1,b)},20); return}
        } 
    }
    
     if(d==2){
        if( okRL.includes(c) ){ move(2,a-1,b); return}
        else{
         if(c=="/"){ move(1,a,b+1); return}
         if(c=="\\"){ move(3,a,b-1); return}
         if(c=="|"){ setTimeout(function(){move(1,a,b+1)},20);
                     setTimeout(function(){move(3,a,b-1)},20); return}
        }
    }
    
    if(d==3){
        if( okUD.includes(c) ){ move(3,a,b-1); return}
        else{
         if(c=="/"){ move(0,a+1,b); return}
         if(c=="\\"){ move(2,a-1,b); return}
         if(c=="-"){ setTimeout(function(){move(0,a+1,b)},20);
                    setTimeout(function(){move(2,a-1,b)},20); return}
        }
    }

    
}

function show(di,p,q){  
    if (di==0){ct1.fillStyle="blue"}
    if (di==1){ct1.fillStyle="green"}
    if (di==2){ct1.fillStyle="red"}
    if (di==3){ct1.fillStyle="brown"}
ct1.fillText("*",10+sc*p,15+sc*q)
}
  
function display(){
  // ct1.clearRect(0,20,800,800)
    for(k=0;k<ins.length;k++){
        grid[k]=ins[k].split("")
      for(j=0;j<ins[k].length;j++){
         ct1.fillText(ins[k].charAt(j), 10+sc*j, 15+sc*k)
      }
    }
}
function coun(){
    var co=0
     for(k=0;k<grid.length;k++){
      for(j=0;j<grid[0].length;j++){
         if(grid[k][j]=="x"){co++}
      }
    }
    return co
}
</script>
</body>
</html>

